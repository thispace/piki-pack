!function($){$(function(){$(".linha-field.ftype-fieldset").fieldset()});var t=$("body");window.fieldset_field_set_callback=function(e){var i=t.data("fieldset_field");void 0===i&&(i=Array()),i.push(e),t.data("fieldset_field",i)},$.fn.fieldset=function(e){return this.each(function(){var e=$(this),i=this;e.is(".multiple")&&(this.configure=function(){this.field_id=e.attr("rel"),this.maximo=void 0==e.attr("--maximo")?0:parseInt(e.attr("--maximo")),this.minimo=void 0==e.attr("--minimo")?0:parseInt(e.attr("--minimo")),this.abertos=void 0==e.attr("--abertos")?0:parseInt(e.attr("--abertos")),this.form=e.parents("form").first(),this.form_id=this.form.find("input.form-id").val(),this.form_key=this.form.find("input.form-key").val(),this.rows=e.children(".field-item").children(".fieldset-group-fields"),this.moving=!1,this.add_button=!1,this.actualize_rows()},this.getFieldsetRow=function(t){var a=$.ajax({url:Piki.ajaxurl,type:"POST",dataType:"json",context:this,beforeSend:function(){$.fn.pikiLoader()},data:{action:"piki_field_ajax",field_type:"fieldset",field_action:"ajax_get_row",form_id:this.form_id,form_key:this.form_key,fieldset_id:this.field_id,field_index:this.rows.length}});a.done(function(t){if($.fn.pikiLoader("close"),"error"==t.status&&"nofieldsetid"==t.type)this.form.PikiForm("finish","Ops! Ocorreu um erro.","Por favor, tente novamente mais tarde.<br />Se o erro persistir, entre em contato com o adminstrador do site.");else{var a=$(t.field);a.hide().appendTo(e.children(".field-item").first()).slideDown(1e3),i.actualize_rows(),i.afterGetRow(a)}}),a.fail(function(t,e){console.log("Request failed: "+e)})},this.actualize_rows=function(){this.rows=e.children(".field-item").children(".fieldset-group-fields").not(".deleted"),this.total_rows=this.rows.length,this.realignIndexes(),this.alignButtons()},this.alignButtons=function(){if(this.rows.length){piki_zebra(this.rows),0===this.maximo||this.total_rows<this.maximo?this.add_button||(this.add_button=$('<span class="button add-button">+ Adicionar</span>'),this.add_button.data("fieldset",{target:this}),this.add_button.on("click",function(t){t.preventDefault();var e=$(this);e.data("fieldset").target.getFieldsetRow(e)}),this.add_button.appendTo(this)):(this.add_button&&this.add_button.remove(),this.add_button=!1);for(var t=this.total_rows>this.minimo,e=0;e<this.total_rows;e++){var a=this.rows.eq(e).data("fieldset",{target:this}),o=a.find(">header .remove-button");t?(o.bind("click.deleteRow",function(t){t.preventDefault(),i.deleteRow(this.target)}),o.show()):o.unbind(".deleteRow").hide()}}},this.afterGetRow=function(e){var i=t.data("fieldset_field");if(void 0!==i&&0!==i.length)for(var a=i.length,o=0;a>o;o++)i[o].call(e.get(0))},this.deleteRow=function(t){t.addClass("deleted"),t.slideUp(800,function(){$(this).remove(),i.actualize_rows()})},this.realignIndexes=function(){this.rows.each(function(t){var e=i.rows.eq(t);i.setRowHeader(this,t),e.children("input.weight").val(t),e.find("input,select,textarea").each(function(){var i=$(this),a=i.attr("id");if(void 0!=a){for(var o=a.split("_"),r=0;r<o.length;r++)if(!isNaN(o[r])){o[r]=t;break}var s=o.join("_");i.attr("id",s)}var n=i.attr("name");if(void 0!=n){for(var d=i.attr("name").split("]["),r=0;r<d.length;r++)if(!isNaN(d[r])){d[r]=t;break}var l=d.join("][");i.attr("name",l)}var h=e.find('label[for="'+a+'"]');h.length&&h.attr("for",s)})})},this.setRowHeader=function(t,e){var a=$(t);void 0===t.header?(t.header={wrapper:$('<header class="clearfix"></header>').prependTo(a)},t.header.title=$("<h3>Item "+(e+1)+"</h3>").appendTo(t.header.wrapper),t.header.title.bind("mouseup",function(){if(i.moving!==!0){var t=a.is(".opened");i.rows.removeClass("opened"),t||a.addClass("opened")}}),t.header.removeButton=$('<span class="dashicons dashicons-trash remove-button"></span>').appendTo(t.header.wrapper),t.header.removeButton.get(0).target=a):t.header.title.html("Item "+(e+1))},void 0==this.data&&this.configure())})}}(jQuery);