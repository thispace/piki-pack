pikiforms_init_methods=[],function($){$(function(){window.initPikiForms()}),window.initPikiForms=function(){$("form.PikiForm").PikiForm(),$.each(pikiforms_init_methods,function(key,method_str){try{var method=eval(method_str);method()}catch(err){console.log(err)}})};var PikiFormMethods={init:function(t){return this.each(function(){var t=$(this),e=t.data("PikiForm");e||t.PikiForm("configure")})},configure:function(t){return this.each(function(){var t=$(this),e=this,i={target:t,key:t.find("input.form-key").val(),id:t.find("input.form-id").val(),action:t.find("input.form-action"),preview:"on"==t.attr("--preview"),submit:t.find(".form-save-button"),original_attr_action:t.attr("action"),original_attr_target:t.attr("target"),report:{tooltips:"true"==t.attr("pikiform-message-tooltip"),inline:"true"==t.attr("pikiform-message-inline"),modal:"true"==t.attr("pikiform-message-modal")}};i.action.data("PikiForm",{initialValue:i.action.val()}),i.submit.data("PikiForm",{target:t,initialLabel:i.submit.val()}),i.submit.click(function(t){t.preventDefault(),$(this).PikiForm("submit")});var r=$(".footer-form input.form-step");if(r.length){var s=t.find(">.form-fields>.form-step");i.steps={step:r,items:s,actual:s.filter("#"+r.val()),status:t.find(">.form-fields>.form-status")},i.steps.top=Math.round(i.steps.status.offset().top),i.steps.status.find(".tabs a").click(function(e){t.PikiForm("changeStep",$(this).attr("rel"))}),$(window).bind("scroll",function(){t.PikiForm("statusPosition")})}i.preview&&(i.previewBack=t.find(".form-alter-button"),i.previewBack.data("PikiForm",{target:t}).click(function(t){t.preventDefault(),$(this).data("PikiForm").target.PikiForm("previewBack")})),t.data("PikiForm",i);var a=$(".tooltip",t);a.length&&a.tooltip({position:{my:"left+3 center",at:"right center"},tooltipClass:"pikiform-tooltip"}),t.delegate("input","keypress",function(t){13===t.which&&(t.preventDefault(),i.submit.click())}),t.PikiForm("initSteps"),t.PikiForm("actualizeButtons")})},statusPosition:function(){return this.each(function(){var t=$(this),e=t.data("PikiForm"),i=Math.round($(window).scrollTop());i>e.steps.top?(e.target.children(".form-fields").css("padding-top",e.steps.status.outerHeight()),e.steps.status.css({position:"fixed",top:0})):(e.target.children(".form-fields").css("padding-top",0),e.steps.status.css({position:"relative",top:"none"}))})},initSteps:function(){return this.each(function(){var t=$(this),e=t.data("PikiForm");if(e.steps){if(e.steps.items.hide().removeClass("active"),""!=window.location.hash){var i=window.location.hash.replace("#","");e.steps.step.val(i)}else var i=e.steps.step.val();e.steps.items.filter("#"+i).addClass("active").show(),e.backButton=$('<input type="button" value="Anterior" />').appendTo(t.children(".footer-form")),e.backButton.data("PikiForm",{target:t}).on("click",function(){$(this).data("PikiForm").target.PikiForm("prevStep")}),t.PikiForm("changeStep",i)}})},changeStep:function(t){return this.each(function(){var e=$(this),i=e.data("PikiForm");e.PikiForm("clearErrors");var r="";i.steps.status.find(".tabs a").removeClass("active error").each(function(){if(!r){var e=$(this);e.addClass("active"),e.attr("rel")==t&&(r=!0)}}),i.steps.actual.attr("id")!=t&&(i.steps.step.val(t),i.steps.actual.slideUp(500,function(){$(this).removeClass("active");var r=i.steps.items.filter("#"+t);r.addClass("active").delay(200).slideDown(400),i.steps.actual=r,e.PikiForm("actualizeButtons")}))})},nextStep:function(t,e){return this.each(function(){var t=$(this),e=t.data("PikiForm"),i=e.steps.actual.next();t.PikiForm("changeStep",i.attr("id"))})},prevStep:function(t,e){return this.each(function(){var t=$(this),e=t.data("PikiForm"),i=e.steps.actual.prev(".form-step");i.length&&t.PikiForm("changeStep",i.attr("id"))})},actualizeButtons:function(){return this.each(function(){var t=$(this),e=t.data("PikiForm");if(e.steps){var i=e.steps.items.length,r=e.steps.items.index(e.steps.actual)+1;1==r?e.backButton.hide():e.backButton.show(),0===r?t.children(".footer-form").slideUp():i>r?e.submit.val("Próxima"):e.preview?(e.submit.val("Próxima"),e.action.val("preview")):e.submit.val(e.submit.data("PikiForm").initialLabel)}})},submit:function(){return this.each(function(){var t=$(this),e=t.data("PikiForm"),i=e.target,r=i.data("PikiForm"),s="preview"==r.action.val()?"previewCallback":"submitCallback";i.PikiForm("clearErrors"),i.ajaxSubmit({type:"POST",dataType:"text",iframe:!1,beforeSubmit:function(){$.fn.pikiLoader()},success:function(t,e,i,s){$.fn.pikiLoader("close");try{var a=$.parseJSON(t)}catch(o){var a=!1}if("preview"!=r.action.val()||a){if(!a)return $.fn.pikiAlert(t+"<br /><br />"+e+"<br /><br />"),!1;s.PikiForm("submitCallback",a)}else s.PikiForm("previewCallback",t)},error:function(t,e,i,r){console.log("Erro!!!"),console.log(t)}})})},submitCallback:function(t){return this.each(function(){var e=$(this),i=e.data("PikiForm");if(i.targetScroll=!1,"error"==t.status&&"valida"==t.error_type)return e.PikiForm("setErrors",t.errors),!1;if("error"==t.status&&"valida"!=t.error_type){var r=void 0!=t.error_message?t.error_message:"Por favor, tente novamente mais tarde.<br />Se o erro persistir, entre em contato com o adminstrador do site.";return e.PikiForm("showInlineMessage",t,"error"),!1}if(e.find(".error").removeClass("error"),i.steps){i.steps.status.find("div.messages").slideUp();var s=i.steps.items.last().attr("id"),a=i.steps.step.val();if(a!=s){var o=i.steps.actual.next().attr("id");return void e.PikiForm("changeStep",o)}}e.PikiForm("finish",t)})},previewCallback:function(t){return this.each(function(){var e=$(this),i=e.data("PikiForm"),r=$(t);$id_item_field=$("input#item_id",e).first(),$(this).slideUp("400",function(){var t=$(this);if(t.children(".form-fields").after(r).hide(),""==$id_item_field.val()){var e=$("input#preview_item_id",r).first().val();$id_item_field.val(e)}i.previewBack.show(),"undefined"!=i.backButton&&i.backButton.hide(),i.submit.val(i.submit.data("PikiForm").initialLabel),i.action.val("publish"),t.slideDown("medium")})})},previewBack:function(){return this.each(function(){var t=$(this),e=t.data("PikiForm"),i=e.target;i.slideUp("400",function(){i.children(".form-preview").remove(),i.children(".form-fields").show(),$(".form-alter-button",i).hide(),i.PikiForm("actualizeButtons"),i.slideDown("medium")})})},setErrors:function(errors){return this.each(function(){var $form=$(this),_this=this,data=$form.data("PikiForm");if(data.steps){var actual_step_key=data.steps.actual.attr("id"),actual_step_status=errors[actual_step_key],total_steps=data.steps.items.length,actual_index=data.steps.items.index(data.steps.actual)+1,error_step_name,error_step_errors;if("error"==errors[actual_step_key].status)$form.PikiForm("setFieldsErros",errors[actual_step_key].errors),data.steps.status.find('.tabs a[rel="'+actual_step_key+'"]').addClass("error"),$form.PikiForm("showInlineMessage",!1);else if(actual_index==total_steps){var error_step_name;$.each(errors,function(t,e){"error"==e.status&&(error_step_name=t)}),$form.PikiForm("changeStep",error_step_name)}else $form.PikiForm("nextStep")}else{var setErros=$form.PikiForm("setFieldsErros",errors);$form.PikiForm("showInlineMessage",errors);try{var _custom_name="window.pikiforms_"+$form.attr("id")+"_set_errors";console.info(_custom_name),_custom=eval(_custom_name),_custom(_this,errors)}catch(err){console.log(err)}}data.report.modal&&$.fn.pikiAlert(setErros.messages)})},finish:function(jSon){return this.each(function(){var $form=$(this),_this=this,data=$form.data("PikiForm");if(data.steps){var _last=data.steps.items.last().attr("id"),_active=data.steps.step.val();if(_active!=_last)return void $form.PikiForm("nextStep")}var message=jSon.message?jSon.message:"Cadastro realizado com sucesso";if(void 0!=data.finishCallback)return void data.finishCallback($form,jSon);try{var _custom_name="window.pikiforms_"+$form.attr("id")+"_submit";return console.info(_custom_name),_custom=eval(_custom_name),_custom($form,jSon),!0}catch(err){return console.log(err),void 0!=jSon.redirect&&""!=jSon.redirect?($.fn.pikiLoader(),void(window.location.href=jSon.redirect)):($form.PikiForm("showInlineMessage",{message:message},"success"),$form.reset(),!0)}})},showInlineMessage:function(jSon,status){var $form=$(this),message=$form.attr("error-message");jSon&&void 0!=jSon.message&&jSon.message&&(message=jSon.message);try{var _custom_name="window.pikiforms_"+$form.attr("id")+"_inline_message";return _custom=eval(_custom_name),_custom($form,jSon),!0}catch(err){var $status=$form.children("div.status");$status.length||($status=$('<div class="status"></div>').prependTo($form).hide()),$status.removeClass("error success alert").addClass(status).html(message).slideDown(),"success"==status&&$status.delay(5e3).slideUp();var eTop=$status.offset().top-25;$("html, body").animate({scrollTop:eTop},800)}},clearErrors:function(){return this.each(function(){var t=$(this),e=t.data("PikiForm"),i=t.children(".footer-form").find("div.status");i.hide(),$(".error",t).removeClass("error"),$(".desc-error").stop(!0,!0).fadeOut(100,function(){$(this).remove()});var r=t.find(".field-item .description");r.length&&r.delay(100).fadeIn(200),$("div.fset-error-status").stop(!0,!0).slideUp(100)})},setFieldsErros:function(t,e){var i=$(this),r=i.data("PikiForm"),s=new Array;return void 0==e&&(e=0),$.each(t,function(t){var a=this;if("fieldset"!=this.field.ftype){var o=".linha-field."+this.field.machine_name;r.targetScroll===!1&&(r.targetScroll=o);var n=i.find(o).eq(e);if(n.addClass("error"),r.report.tooltips===!0||r.report.inline===!0){var l,c,d;r.report.tooltips===!0?l=n.children(".linha-field-label"):r.report.inline===!0&&(l=n.children(".field-item"),d=n.find(".description"),d.length&&d.hide()),c=l.children("span.desc-error"),c.length||(r.report.tooltips===!0?c=$('<span class="desc-error tooltip" title="'+this.error+'"></span>').appendTo(l):r.report.inline===!0&&(c=$('<span class="desc-error inline">'+this.error+"</span>").appendTo(l))),c.stop(!0,!0).fadeIn("300")}s.push("- "+this.error)}else if("string"===$.type(this.error)){var m=$("#"+this.field.machine_name,i);m.addClass("fset-error");var f=m.find("div.fset-error-status");f.length||(f=$('<div class="fset-error-status"></div>').prependTo(m).hide()),f.html(this.error).slideDown(400)}else $.each(this.error,function(t){_fset_erros=i.PikiForm("setFieldsErros",this.errors,t),_fset_erros&&(0==t&&(targetScroll=_fset_erros.targetScroll),s.push('<div class="fieldset"><h3>'+a.field.label+'</h3><p class="subfields">'+_fset_erros.messages+"</p></div>"))})}),$(".desc-error",i).tooltip({position:{my:"left+3 center",at:"right center"},tooltipClass:"pikiform-tooltip-error"}),s.length>0?{messages:s.join("<br />")}:!1},resetForm:function(){return this.each(function(){var t=$(this);t.PikiForm("clearErrors").reset()})}};$.fn.PikiForm=function(t){return PikiFormMethods[t]?PikiFormMethods[t].apply(this,Array.prototype.slice.call(arguments,1)):PikiFormMethods.init.apply(this,arguments)},window.pikiform_do_delete=function(t){$.fn.pikiLoader();var e=t.parents(".pikiforms-actions-buttons"),i=$.ajax({url:$("a.delete",e).attr("href"),type:"POST",dataType:"json"});i.done(function(t){$.fn.pikiLoader("close"),"error"==t.status?$.fn.pikiAlert("Ops! Ocorreu um erro.<br />Por favor, tente novamente mais tarde.<br />Se o erro persistir, entre em contato com o adminstrador do site."):(e.addClass("success"),$("div.bttons",e).hide(),$("span.question",e).html(t.message),void 0!=t.redirect&&setTimeout("window.location.href='"+t.redirect+"';",1500))}),i.fail(function(t,e){console.log("Request failed: "+e)})}}(jQuery);