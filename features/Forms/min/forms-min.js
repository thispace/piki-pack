pikiforms_init_methods=[];var PikiForms;!function($){$(function(){window.initPikiForms()}),window.initPikiForms=function(){$("form").each(function(){void 0===this.$&&(this.$=$(this)),this.is_pikiform="true"===this.$.attr("data-piki-form"),this.is_pikiform&&PikiForms.init(this)}),$.each(pikiforms_init_methods,function(key,method_str){try{var method=eval(method_str);method()}catch(err){console.log(err)}})},PikiForms={init:function t(e){var i=$(e),s=i.data("PikiForms");if(void 0===s){var s={$:i,_:e};s.$.data("PikiForms",s),PikiForms.structure(s),PikiForms.configure(s)}},structure:function e(t){t.$action=$("input.form-action",t.$),t.$action.data("PikiForm",{initialValue:t.$action.val()}),"post"===t.$.attr("id")?(t.isAdmin=!0,t.$submit=$("input#publish",t.$),t.$preview=$("input#post-preview",t.$)):(t.isAdmin=!1,t.$submit=$(".form-save-button",t.$)),t.$submit.data("PikiForm",{initialLabel:t.$submit.val()}),t.$footer=t.$.children(".footer-form"),t.key=$("input.form-key",t.$).val(),t.id=$("input.form-id",t.$).val(),t.preview="on"===t.$.attr("--preview"),t.original_attr_action=t.$.attr("action"),t.original_attr_target=t.$.attr("target"),t.report={tooltips:"true"===t.$.attr("pikiform-message-tooltip"),inline:"true"===t.$.attr("pikiform-message-inline"),modal:"true"===t.$.attr("pikiform-message-modal")},t.$previewBack=t.$.find(".form-alter-button"),t.$tooltips=$(".tooltip",t.$);var e=$("input.form-step",t.$footer);if(e.length){var i=t.$.find(">.form-fields>.form-step"),s=t.$.find(">.form-fields>.form-status");t.steps={$field:e,$step:$step,$items:i,$actual:i.filter("#"+$step.val()),$status:s,$triggers:s.find(".tabs a")},t.steps.top=Math.round(t.steps.$status.offset().top)}},configure:function i(t){t.$submit.click(function(e){e.preventDefault(),PikiForms.submit(t)}),t.preview&&t.$previewBack.length&&t.$previewBack.on("click",function(e){e.preventDefault(),PikiForms.previewBack(t)}),t.$tooltips.length&&t.$tooltips.tooltip({position:{my:"left+3 center",at:"right center"},tooltipClass:"pikiform-tooltip"}),t.$.delegate("input","keypress",function(e){13===e.which&&(e.preventDefault(),t.$submit.click())}),void 0!==t.steps&&PikiForms.initSteps(t),PikiForms.actualizeButtons(t)},initSteps:function s(t){if(t.steps.$triggers.on("click",function(e){PikiForms.changeStep(t,$(this).attr("rel"))}),t.steps.$items.hide().removeClass("active"),""!=window.location.hash){var e=window.location.hash.replace("#","");t.steps.$step.val(e)}else var e=t.steps.$step.val();t.steps.$items.filter("#"+e).addClass("active").show(),t.$backButton=$('<input type="button" value="Anterior" />').appendTo(t.$footer),t.$backButton.on("click",function(){PikiForms.prevStep(t)}),PikiForms.changeStep(t,e),$(window).bind("scroll",function(){PikiForms.statusPosition(t)})},statusPosition:function r(t){var e=Math.round($(window).scrollTop());e>t.steps.top?(t.$.children(".form-fields").css("padding-top",t.steps.$status.outerHeight()),t.steps.$status.css({position:"fixed",top:0})):(t.$.children(".form-fields").css("padding-top",0),t.steps.$status.css({position:"relative",top:"none"}))},changeStep:function a(t,e){PikiForms.clearErrors(t);var i="";t.steps.$triggers.removeClass("active error").each(function(){void 0===this.$&&(this.$=$(this)),i||(this.$.addClass("active"),this.$.attr("rel")===e&&(i=!0))}),t.steps.$actual.attr("id")!==e&&(t.steps.$step.val(e),t.steps.$actual.slideUp(500,function(){void 0===this.$&&(this.$=$(this)),this.$.removeClass("active");var i=t.steps.$items.filter("#"+e);i.addClass("active").delay(200).slideDown(400),t.steps.$actual=i,PikiForms.actualizeButtons(t)}))},nextStep:function o(t){var e=t.steps.$actual.next();e.length&&PikiForms.changeStep(t,e.attr("id"))},prevStep:function n(t){var e=t.steps.$actual.prev(".form-step");e.length&&PikiForms.changeStep(t,e.attr("id"))},actualizeButtons:function l(t){if(t.steps){var e=t.steps.$items.length,i=t.steps.$items.index(t.steps.$actual)+1;1==i?t.$backButton.hide():t.$backButton.show(),0===i?t.$footer.slideUp():e>i?t.$submit.val("Próxima"):t.preview?(t.$submit.val("Próxima"),t.$action.val("preview")):t.$submit.val(t.$submit.data("PikiForm").initialLabel)}},submit:function d(t){PikiForms.clearErrors(t);var e="preview"==t.$action.val()?"previewCallback":"submitCallback",i=t.isAdmin===!0?ajaxurl:t.$.attr("action");t.$.ajaxSubmit({url:i,type:"POST",dataType:"text",iframe:!1,beforeSubmit:function(){$.fn.pikiLoader()},success:function(e,i,s,r){$.fn.pikiLoader("close");try{var a=$.parseJSON(e)}catch(o){var a=!1}if("preview"!=t.$action.val()||a){if(!a)return $.fn.pikiAlert(e+"<br /><br />"+i+"<br /><br />"),!1;PikiForms.submitCallback(t,a)}else PikiForms.previewCallback(t,e)},error:function(t,e,i,s){console.log("Erro!!!"),console.log(t)}})},submitCallback:function c(t,e){if(t.targetScroll=!1,"error"===e.status){if("valida"===e.error_type)PikiForms.setErrors(t,e.errors);else{var i=void 0!=e.error_message?e.error_message:"Por favor, tente novamente mais tarde.<br />Se o erro persistir, entre em contato com o adminstrador do site.";PikiForms.showInlineMessage(t,e,"error")}return!1}if(t.$.find(".error").removeClass("error"),t.steps){t.steps.$status.find("div.messages").slideUp();var s=t.steps.$items.last().attr("id"),r=t.steps.$step.val();if(r!=s){var a=t.steps.$actual.next().attr("id");return void PikiForms.changeStep(t,a)}}PikiForms.finish(t,e)},previewCallback:function p(t,e){var i=$(e);$id_item_field=$("input#item_id",t.$).first(),t.$.slideUp("400",function(){if(t.$.children(".form-fields").after(i).hide(),""===$id_item_field.val()){var e=$("input#preview_item_id",i).first().val();$id_item_field.val(e)}t.$previewBack.show(),"undefined"!==t.$backButton&&t.$backButton.hide(),t.$submit.val(t.$submit.data("PikiForm").initialLabel),t.$action.val("publish"),t.$.slideDown("medium")})},previewBack:function m(t){t.$.slideUp("400",function(){t.$.children(".form-preview").remove(),t.$.children(".form-fields").show(),$(".form-alter-button",t.$).hide(),PikiForms.actualizeButtons(),t.$.slideDown("medium")})},setErrors:function setErrors(data,errors){if(data.steps){var actual_step_key=data.steps.$actual.attr("id"),actual_step_status=errors[actual_step_key],total_steps=data.steps.$items.length,actual_index=data.steps.$items.index(data.steps.$actual)+1,error_step_name,error_step_errors;if("error"===errors[actual_step_key].status)PikiForms.setFieldsErros(data,errors[actual_step_key].errors),data.steps.$triggers.filter('[rel="'+actual_step_key+'"]').addClass("error"),PikiForms.showInlineMessage(data,"error");else if(actual_index==total_steps){var error_step_name;$.each(errors,function(t,e){"error"==e.status&&(error_step_name=t)}),PikiForms.changeStep(data,error_step_name)}else PikiForms.nextStep(data)}else{var setErros=PikiForms.setFieldsErros(data,errors);PikiForms.showInlineMessage(data,errors,"error");try{var _custom_name="window.pikiforms_"+data.$.attr("id")+"_set_errors";console.info(_custom_name),_custom=eval(_custom_name),_custom(data._,errors)}catch(err){console.log(err)}}data.report.modal&&$.fn.pikiAlert(setErros.messages)},finish:function finish(data,jSon){if(data.steps){var _last=data.steps.$items.last().attr("id"),_active=data.steps.$step.val();if(_active!=_last)return void PikiForms.nextStep(data)}var message=jSon.message?jSon.message:"Cadastro realizado com sucesso";if(void 0!==data.$finishCallback)return void data.$finishCallback(data.$,jSon);try{var _custom_name="window.pikiforms_"+data.$.attr("id")+"_submit";return _custom=eval(_custom_name),_custom(data.$,jSon),!0}catch(err){return console.log(err),void 0!==jSon.redirect&&""!==jSon.redirect?($.fn.pikiLoader(),void(window.location.href=jSon.redirect)):(PikiForms.showInlineMessage(data,{message:message},"success"),"update"!==jSon.action&&data.$.reset(),!0)}},showInlineMessage:function showInlineMessage(data,jSon,status){var message=data.$.attr("error-message");jSon&&void 0!=jSon.message&&jSon.message&&(message=jSon.message);try{var _custom_name="window.pikiforms_"+data.$.attr("id")+"_inline_message";return _custom=eval(_custom_name),_custom(data.$,jSon),!0}catch(err){var $status=data.$.children("div.status");$status.length||($status=$('<div class="status"></div>').prependTo(data.$).hide()),$status.removeClass("error success alert").addClass(status).html("<p>"+message+"</p>").slideDown(),"success"==status&&$status.delay(5e3).slideUp();var eTop=$status.offset().top-25;$("html, body").animate({scrollTop:eTop},800)}},clearErrors:function u(t){var e=t.$.children("div.status");e.hide(),$(".error",t.$).removeClass("error"),$(".desc-error").stop(!0,!0).fadeOut(100,function(){$(this).remove()});var i=t.$.find(".field-item .description");i.length&&i.delay(100).fadeIn(200),$("div.fset-error-status",t.$).stop(!0,!0).slideUp(100)},setFieldsErros:function f(t,e,i){var s=new Array;return void 0==i&&(i=0),$.each(e,function(e){var r=this;if("fieldset"===this.field.ftype)if("string"===$.type(this.error)){var a=$("#"+this.field.machine_name,t.$);a.addClass("fset-error");var o=a.find("div.fset-error-status");o.length||(o=$('<div class="fset-error-status"></div>').prependTo(a).hide()),o.html(this.error).slideDown(400)}else $.each(this.error,function(e){_fset_erros=PikiForms.setFieldsErros(t,this.errors,e),_fset_erros&&(0==e&&(targetScroll=_fset_erros.targetScroll),s.push('<div class="fieldset"><h3>'+r.field.label+'</h3><p class="subfields">'+_fset_erros.messages+"</p></div>"))});else{var n;n=Piki.is_admin===!0&&"title"===this.field.ftype?"input#title":".linha-field."+this.field.machine_name,t.targetScroll===!1&&(t.targetScroll=n);var l=t.$.find(n).eq(i);if(l.addClass("error"),t.report.tooltips===!0||t.report.inline===!0){var d,c,p;t.report.tooltips===!0?d=l.children(".linha-field-label"):t.report.inline===!0&&(d=l.children(".field-item"),p=l.find(".description"),p.length&&p.hide()),c=d.children("span.desc-error"),c.length||(t.report.tooltips===!0?c=$('<span class="desc-error tooltip" title="'+this.error+'"></span>').appendTo(d):t.report.inline===!0&&(c=$('<span class="desc-error inline">'+this.error+"</span>").appendTo(d))),c.stop(!0,!0).fadeIn("300")}s.push("- "+this.error)}}),$(".desc-error",t.$).tooltip({position:{my:"left+3 center",at:"right center"},tooltipClass:"pikiform-tooltip-error"}),s.length>0?{messages:s.join("<br />")}:!1},resetForm:function v(t){t.$.reset(),PikiForms.clearErrors()}},window.pikiform_do_delete=function(t){$.fn.pikiLoader();var e=t.parents(".pikiforms-actions-buttons"),i=$.ajax({url:$("a.delete",e).attr("href"),type:"POST",dataType:"json"});i.done(function(t){$.fn.pikiLoader("close"),"error"==t.status?$.fn.pikiAlert("Ops! Ocorreu um erro.<br />Por favor, tente novamente mais tarde.<br />Se o erro persistir, entre em contato com o adminstrador do site."):(e.addClass("success"),$("div.bttons",e).hide(),$("span.question",e).html(t.message),void 0!=t.redirect&&setTimeout("window.location.href='"+t.redirect+"';",1500))}),i.fail(function(t,e){console.log("Request failed: "+e)})}}(jQuery);